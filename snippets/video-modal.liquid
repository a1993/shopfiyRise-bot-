{% comment %}
  视频播放 Modal 组件
  Video Modal Component
  
  参数:
  - modal_id: Modal 的唯一 ID (required, default: 'video-modal')
  - video_url: 视频 URL (optional, 可通过 JS 动态设置)
  
  使用示例:
  {% render 'video-modal', modal_id: 'durable-video-modal' %}
  
  触发 Modal 的按钮:
  <button onclick="openVideoModal('durable-video-modal', 'https://youtube.com/embed/...')">播放视频</button>
{% endcomment %}

{%- liquid
  assign modal_id = modal_id | default: 'video-modal'
-%}

<div 
  id="{{ modal_id }}" 
  class="durable-video-modal" 
  role="dialog" 
  aria-modal="true" 
  aria-hidden="true"
>
  <div class="durable-modal-overlay" onclick="closeVideoModal('{{ modal_id }}')">
    <button 
      type="button" 
      class="durable-modal-close" 
      onclick="event.stopPropagation(); closeVideoModal('{{ modal_id }}')"
      aria-label="Close Modal"
    >
      &times;
    </button>
  </div>
  <div class="durable-modal-content" onclick="event.stopPropagation()">
    <div class="durable-modal-video" id="{{ modal_id }}-video-container"></div>
  </div>
</div>

<script>
// Video Modal Control Functions
(function() {
  'use strict';
  
  // 确保函数只定义一次
  if (typeof window.openVideoModal !== 'function') {
    window.openVideoModal = function(modalId, videoUrl) {
      const modal = document.getElementById(modalId);
      if (!modal) return;
      
      const videoContainer = document.getElementById(modalId + '-video-container');
      if (!videoContainer) return;
      
      // 创建 iframe
      const iframe = document.createElement('iframe');
      iframe.src = videoUrl;
      iframe.frameBorder = '0';
      iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
      iframe.allowFullscreen = true;
      iframe.style.width = '100%';
      iframe.style.height = '100%';
      iframe.style.position = 'absolute';
      iframe.style.top = '0';
      iframe.style.left = '0';
      
      videoContainer.innerHTML = '';
      videoContainer.appendChild(iframe);
      
      modal.classList.add('active');
      modal.setAttribute('aria-hidden', 'false');
      document.body.style.overflow = 'hidden';
    };
  }
  
  if (typeof window.closeVideoModal !== 'function') {
    window.closeVideoModal = function(modalId) {
      const modal = document.getElementById(modalId);
      if (!modal) return;
      
      const videoContainer = document.getElementById(modalId + '-video-container');
      if (videoContainer) {
        videoContainer.innerHTML = '';
      }
      
      modal.classList.remove('active');
      modal.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = '';
    };
  }
  
  // ESC 键关闭 Modal
  if (!window._durableVideoModalEscHandler) {
    window._durableVideoModalEscHandler = function(e) {
      if (e.key === 'Escape') {
        const activeModal = document.querySelector('.durable-video-modal.active');
        if (activeModal) {
          closeVideoModal(activeModal.id);
        }
      }
    };
    document.addEventListener('keydown', window._durableVideoModalEscHandler);
  }
})();
</script>

<style>
/* Video Modal */
.durable-video-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 9999;
}

.durable-video-modal.active {
  display: block;
}

.durable-modal-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.85);
  cursor: pointer;
}

.durable-modal-close {
  position: absolute;
  top: 1rem;
  right: 1rem;
  background: rgba(255, 255, 255, 0.2);
  border: 2px solid rgba(255, 255, 255, 0.5);
  color: #fff;
  font-size: 2rem;
  cursor: pointer;
  padding: 0;
  width: 2.5rem;
  height: 2.5rem;
  line-height: 1;
  z-index: 10000;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background-color 0.3s ease, border-color 0.3s ease;
  font-family: Arial, sans-serif;
  font-weight: 300;
}

.durable-modal-close:hover {
  background: rgba(255, 255, 255, 0.3);
  border-color: rgba(255, 255, 255, 0.8);
}

.durable-modal-content {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 90%;
  max-width: 1200px;
  background: #000;
  border-radius: 0.5rem;
  overflow: hidden;
  pointer-events: none;
}

.durable-modal-video {
  position: relative;
  padding-bottom: 56.25%;
  height: 0;
  overflow: hidden;
  pointer-events: auto;
}

.durable-modal-video iframe {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

/* Mobile Responsive */
@media screen and (max-width: 767px) {
  .durable-modal-content {
    width: 95%;
  }
  
  .durable-modal-close {
    top: 0.5rem;
    right: 0.5rem;
    width: 2rem;
    height: 2rem;
    font-size: 1.5rem;
    border-width: 1px;
  }
}
</style>

