{% comment %}
  通用 Modal 弹窗组件
  Common Modal Component
  
  参数:
  - modal_id: Modal 的唯一 ID (required)
  - modal_content: Modal 内容 (required, 通常通过 capture 传入)
  - size: Modal 尺寸 (default: 'medium', 可选: small, medium, large, xlarge, full)
  - close_on_backdrop: 点击背景关闭 (default: true)
  - show_close_button: 显示关闭按钮 (default: true)
  - custom_class: 自定义 CSS 类名 (optional)
  
  使用示例:
  {% capture modal_content %}
    <h2>Modal Title</h2>
    <p>Modal content goes here...</p>
    <iframe src="https://youtube.com/..." width="100%" height="450"></iframe>
  {% endcapture %}
  
  {% render 'common-modal',
    modal_id: 'video-modal',
    modal_content: modal_content,
    size: 'large'
  %}
  
  触发 Modal 的按钮:
  <button onclick="openModal('video-modal')">Open Modal</button>
{% endcomment %}

{%- liquid
  assign modal_id = modal_id | default: 'common-modal'
  assign modal_content = modal_content | default: ''
  assign size = size | default: 'medium'
  assign close_on_backdrop = close_on_backdrop | default: true
  assign show_close_button = show_close_button | default: true
  assign custom_class = custom_class | default: ''
-%}

<div 
  id="{{ modal_id }}" 
  class="common-modal {{ custom_class }}" 
  role="dialog" 
  aria-modal="true" 
  aria-hidden="true"
  {% if close_on_backdrop %}onclick="if(event.target === this) closeModal('{{ modal_id }}')"{% endif %}
>
  <div class="common-modal__backdrop"></div>
  
  <div class="common-modal__wrapper">
    <div class="common-modal__dialog common-modal__dialog--{{ size }}">
      {% if show_close_button %}
        <button 
          type="button" 
          class="common-modal__close" 
          onclick="closeModal('{{ modal_id }}')"
          aria-label="Close Modal"
        >
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      {% endif %}
      
      <div class="common-modal__content">
        {{ modal_content }}
      </div>
    </div>
  </div>
</div>

<script>
// Modal Control Functions
window.openModal = function(modalId) {
  const modal = document.getElementById(modalId);
  if (modal) {
    modal.classList.add('common-modal--active');
    modal.setAttribute('aria-hidden', 'false');
    document.body.style.overflow = 'hidden';
    
    // 触发自定义事件
    modal.dispatchEvent(new CustomEvent('modal:opened', { detail: { modalId } }));
  }
};

window.closeModal = function(modalId) {
  const modal = document.getElementById(modalId);
  if (modal) {
    modal.classList.remove('common-modal--active');
    modal.setAttribute('aria-hidden', 'true');
    document.body.style.overflow = '';
    
    // 触发自定义事件
    modal.dispatchEvent(new CustomEvent('modal:closed', { detail: { modalId } }));
  }
};

// ESC 键关闭 Modal
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    const activeModal = document.querySelector('.common-modal--active');
    if (activeModal) {
      closeModal(activeModal.id);
    }
  }
});
</script>

<style>
  /* Modal Overlay */
  .common-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 9999;
    display: none;
    align-items: center;
    justify-content: center;
  }
  
  .common-modal--active {
    display: flex;
  }
  
  /* Modal Backdrop */
  .common-modal__backdrop {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.75);
    animation: fadeIn 0.3s ease;
  }
  
  /* Modal Wrapper */
  .common-modal__wrapper {
    position: relative;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1rem;
    overflow-y: auto;
  }
  
  /* Modal Dialog */
  .common-modal__dialog {
    position: relative;
    background: #fff;
    border-radius: 0.5rem;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    max-height: 90vh;
    overflow-y: auto;
    animation: slideUp 0.3s ease;
  }
  
  /* Dialog Size Variants */
  .common-modal__dialog--small {
    max-width: 28rem; /* 448px */
  }
  
  .common-modal__dialog--medium {
    max-width: 42rem; /* 672px */
  }
  
  .common-modal__dialog--large {
    max-width: 56rem; /* 896px */
  }
  
  .common-modal__dialog--xlarge {
    max-width: 72rem; /* 1152px */
  }
  
  .common-modal__dialog--full {
    max-width: 95%;
    max-height: 95vh;
  }
  
  /* Close Button */
  .common-modal__close {
    position: absolute;
    top: 1rem;
    right: 1rem;
    width: 2.5rem;
    height: 2.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0, 0, 0, 0.5);
    color: #fff;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    z-index: 10;
    transition: background-color 0.2s ease;
  }
  
  .common-modal__close:hover {
    background: rgba(0, 0, 0, 0.7);
  }
  
  /* Modal Content */
  .common-modal__content {
    padding: 2rem;
  }
  
  /* Animations */
  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }
  
  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(2rem) scale(0.95);
    }
    to {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }
  
  /* Mobile Responsive */
  @media screen and (max-width: 767px) {
    .common-modal__wrapper {
      padding: 0.5rem;
    }
    
    .common-modal__dialog {
      max-height: 95vh;
      border-radius: 0.375rem;
    }
    
    .common-modal__dialog--small,
    .common-modal__dialog--medium,
    .common-modal__dialog--large,
    .common-modal__dialog--xlarge {
      max-width: 100%;
    }
    
    .common-modal__content {
      padding: 1.5rem 1rem;
    }
    
    .common-modal__close {
      top: 0.5rem;
      right: 0.5rem;
      width: 2rem;
      height: 2rem;
    }
    
    .common-modal__close svg {
      width: 18px;
      height: 18px;
    }
  }
  
  /* Video/iframe 自适应 */
  .common-modal__content iframe {
    max-width: 100%;
    border-radius: 0.375rem;
  }
</style>

