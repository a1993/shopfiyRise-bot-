var e=Object.defineProperty,t=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,r=(t,o,s)=>o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[o]=s,n=(e,n)=>{for(var a in n||(n={}))o.call(n,a)&&r(e,a,n[a]);if(t)for(var a of t(n))s.call(n,a)&&r(e,a,n[a]);return e},a=(e,t,o)=>new Promise((s,r)=>{var n=e=>{try{i(o.next(e))}catch(t){r(t)}},a=e=>{try{i(o.throw(e))}catch(t){r(t)}},i=e=>e.done?s(e.value):Promise.resolve(e.value).then(n,a);i((o=o.apply(e,t)).next())});import{r as i,c as l,o as c,a as u,b as d,d as p,t as v,u as h,F as f,e as m,f as y,n as g,g as w,h as b,i as S}from"./vote-widget-vendor.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const o of e)if("childList"===o.type)for(const e of o.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class E{constructor(e){this.config=e,this.baseUrl=e.apiEndpoint||"/apps/campaign-api"}request(e){return a(this,arguments,function*(e,t={}){const o=`${this.baseUrl}${e}`,s={headers:n({"Content-Type":"application/json",Accept:"application/json"},t.headers)};try{const e=yield fetch(o,n(n({},s),t));if(!e.ok)throw new Error(`API request failed: ${e.statusText}`);return yield e.json()}catch(r){throw r}})}graphql(e){return a(this,arguments,function*(e,t={}){const o=yield fetch("/api/2024-01/graphql.json",{method:"POST",headers:{"Content-Type":"application/json","X-Shopify-Storefront-Access-Token":this.config.storefrontToken},body:JSON.stringify({query:e,variables:t})}),s=yield o.json();if(s.errors)throw new Error(s.errors[0].message);return s.data})}}class k{static get(e,t=null){try{const o=localStorage.getItem(e);return o?JSON.parse(o):t}catch(o){return t}}static set(e,t){try{return localStorage.setItem(e,JSON.stringify(t)),!0}catch(o){return!1}}static remove(e){localStorage.removeItem(e)}static clear(){localStorage.clear()}}function I(e){const t=function(e){var t,o,s,r;return"undefined"==typeof window?null:(null==(t=window.SHOPIFY_HEADLESS_CONFIG)?void 0:t[e])||{shopUrl:(null==(o=window.Shopify)?void 0:o.shop)||"",locale:document.documentElement.lang||"en",currency:(null==(r=null==(s=window.Shopify)?void 0:s.currency)?void 0:r.active)||"USD"}}(e);return{shopUrl:(null==t?void 0:t.shopUrl)||"",apiEndpoint:(null==t?void 0:t.apiEndpoint)||"/apps/campaign-api",locale:(null==t?void 0:t.locale)||"en",currency:(null==t?void 0:t.currency)||"USD",customer:(null==t?void 0:t.customer)||null,votingEnabled:!0,maxVotesPerUser:1,showResults:!0,isDev:!1,apiUrl:null==t?void 0:t.apiEndpoint,features:{realTimeUpdates:!0,socialSharing:!0,analytics:!0}}}const O="/vote",V="/results",P="vote:success",U="vote:error",j="results:updated",C="campaign_user_votes";const D={class:"widget-header"},N={class:"widget-title"},T={class:"widget-description"},q={key:0,class:"error-message"},_={key:1,class:"success-message"},F={class:"products-grid"},x={class:"product-image"},L=["src","alt"],A={key:0,class:"vote-badge"},R={class:"product-info"},M={class:"product-title"},H={key:0,class:"product-description"},J=["disabled","onClick"],Y={key:0,class:"product-results"},$={class:"progress-bar"},B={class:"vote-stats"},G={class:"vote-count"},W={class:"vote-percentage"},z={key:2,class:"widget-footer"},K={class:"total-votes"},X={key:0,class:"dev-tools"},Q=((e,t)=>{const o=e.__vccOpts||e;for(const[s,r]of t)o[s]=r;return o})({__name:"App",setup(e){var t;const o=i((null==(t=document.querySelector('[id^="headless-app-"]'))?void 0:t.id)||"default"),s=I(o.value),{loading:r,error:n,results:S,canVote:Q,submitVote:Z,fetchResults:ee,hasVotedFor:te,clearVotes:oe}=function(e){const t=I(e),o=new E(t),s=i(!1),r=i(null),n=i(k.get(C,[])),c=i([]),u=l(()=>n.value.length>0),d=l(()=>!!t.votingEnabled&&(-1===t.maxVotesPerUser||n.value.length<t.maxVotesPerUser));function p(){return a(this,null,function*(){s.value=!0,r.value=null;try{const e=yield o.request(V);e.success&&(c.value=e.results,v(j,{results:e.results}))}catch(e){r.value=e.message}finally{s.value=!1}})}function v(e,t){window.dispatchEvent(new CustomEvent(e,{detail:t}))}return{loading:s,error:r,userVotes:n,results:c,hasVoted:u,canVote:d,submitVote:function(e){return a(this,null,function*(){var a;if(!d.value)return r.value="You have reached the maximum number of votes",!1;s.value=!0,r.value=null;try{const s=yield o.request(O,{method:"POST",body:JSON.stringify({productId:e,customerId:null==(a=t.customer)?void 0:a.id,timestamp:Date.now()})});if(s.success)return n.value.push({productId:e,timestamp:Date.now()}),k.set(C,n.value),v(P,{productId:e}),yield p(),!0;throw new Error(s.message||"Vote failed")}catch(i){return r.value=i.message,v(U,{error:i.message}),!1}finally{s.value=!1}})},fetchResults:p,hasVotedFor:function(e){return n.value.some(t=>t.productId===e)},clearVotes:function(){}}}(o.value),se=i([]),re=i(!1),ne=l(()=>S.value.reduce((e,t)=>e+(t.votes||0),0));function ae(e){const t=S.value.find(t=>t.productId===e);return(null==t?void 0:t.votes)||0}function ie(e){if(0===ne.value)return 0;const t=ae(e);return Math.round(t/ne.value*100)}function le(e){if(!S.value.length)return!1;const t=Math.max(...S.value.map(e=>e.votes||0));return ae(e)===t&&t>0}return c(()=>a(this,null,function*(){try{se.value=[{id:"1",title:"Holiday Curls",description:"Perfect beach waves for the holidays",image:"https://cdn.shopify.com/s/files/1/0001/0001/products/product-1.jpg"},{id:"2",title:"Festive Braids",description:"Elegant braided hairstyle",image:"https://cdn.shopify.com/s/files/1/0001/0001/products/product-2.jpg"},{id:"3",title:"Winter Waves",description:"Smooth and shiny winter waves",image:"https://cdn.shopify.com/s/files/1/0001/0001/products/product-3.jpg"},{id:"4",title:"Party Updo",description:"Glamorous updo for parties",image:"https://cdn.shopify.com/s/files/1/0001/0001/products/product-4.jpg"}],yield ee()}catch(e){}})),(e,t)=>(w(),u("div",{class:g(["vote-widget",{"is-loading":h(r)}])},[d("header",D,[d("h2",N,v(h(s).title||"Vote for Your Favorite"),1),d("p",T,v(h(s).description),1)]),h(n)?(w(),u("div",q,[d("p",null,v(h(n)),1),d("button",{onClick:t[0]||(t[0]=e=>n.value=null)},"Dismiss")])):p("",!0),re.value?(w(),u("div",_,[...t[3]||(t[3]=[d("p",null,"✅ Thank you for voting!",-1)])])):p("",!0),d("div",F,[(w(!0),u(f,null,m(se.value,e=>(w(),u("div",{key:e.id,class:g(["product-card",{"has-voted":h(te)(e.id),"is-winner":le(e.id)}])},[d("div",x,[d("img",{src:e.image,alt:e.title,loading:"lazy"},null,8,L),h(te)(e.id)?(w(),u("div",A,"✓ Your Vote")):p("",!0)]),d("div",R,[d("h3",M,v(e.title),1),e.description?(w(),u("p",H,v(e.description),1)):p("",!0)]),d("button",{class:"vote-button",disabled:!h(Q)||h(te)(e.id),onClick:t=>function(e){return a(this,null,function*(){(yield Z(e))&&(re.value=!0,setTimeout(()=>{re.value=!1},3e3))})}(e.id)},[h(te)(e.id)?(w(),u(f,{key:0},[y(" Voted ✓ ")],64)):h(Q)?(w(),u(f,{key:2},[y(" Vote Now ")],64)):(w(),u(f,{key:1},[y(" Voting Closed ")],64))],8,J),h(s).showResults&&h(S).length?(w(),u("div",Y,[d("div",$,[d("div",{class:"progress-fill",style:b({width:ie(e.id)+"%"})},null,4)]),d("div",B,[d("span",G,v(ae(e.id))+" votes",1),d("span",W,v(ie(e.id))+"%",1)])])):p("",!0)],2))),128))]),h(s).showFooter?(w(),u("footer",z,[d("p",K,[t[4]||(t[4]=y(" Total votes: ",-1)),d("strong",null,v(ne.value),1)]),h(false)?(w(),u("div",X,[d("button",{onClick:t[1]||(t[1]=(...e)=>h(oe)&&h(oe)(...e))},"Clear My Votes"),d("button",{onClick:t[2]||(t[2]=(...e)=>h(ee)&&h(ee)(...e))},"Refresh Results")])):p("",!0)])):p("",!0)],2))}},[["__scopeId","data-v-53f5518d"]]);function Z(e){try{const t={appName:e.dataset.appName||"vote-widget",apiEndpoint:e.dataset.apiEndpoint||"/apps/campaign-api",shopUrl:e.dataset.shopUrl||"",shopDomain:e.dataset.shopDomain||"",locale:e.dataset.locale||"en",currency:e.dataset.currency||"USD",customerId:e.dataset.customerId||null,customerEmail:e.dataset.customerEmail||null,customData:ee(e.dataset.custom)},o=S(Q,{config:t,sectionId:e.id});o.config.errorHandler=(t,o,s)=>{te(e,t.message)},o.mount(e),window.dispatchEvent(new CustomEvent("vue:mounted",{detail:{containerId:e.id,config:t}}))}catch(t){te(e,"Failed to load the application. Please refresh the page.")}}function ee(e){if(!e)return null;try{return JSON.parse(e)}catch(t){return null}}function te(e,t){const o=`\n    <div class="vue-app-error">\n      <h3>⚠️ Error</h3>\n      <p>${t}</p>\n      <button onclick="location.reload()">Refresh Page</button>\n    </div>\n  `;e.innerHTML=o;const s=document.getElementById(e.id.replace("headless-app-","headless-error-"));s&&(s.style.display="block")}document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelectorAll('[id^="headless-app-"]');if(0===e.length){const e=document.querySelector("#app");e&&Z(e)}else e.forEach(e=>{Z(e)})});
