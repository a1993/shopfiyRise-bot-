{% comment %}
  Halloween Hair System Sale Section
  万圣节发制品促销页面 - 支持多个产品分类滑动展示
{% endcomment %}

{{ 'halloween-hair-system-sale.css' | asset_url | stylesheet_tag }}
<script src="{{ 'halloween-hair-system-sale.js' | asset_url }}" defer></script>

{%- liquid
  assign banner_desktop = section.settings.banner_desktop
  assign banner_mobile = section.settings.banner_mobile
-%}

<!-- Banner -->
{% render 'campaign-banner',
  banner_desktop: banner_desktop,
  banner_mobile: banner_mobile,
  banner_alt: section.settings.banner_alt,
  sticky: false
%}

<!-- Main Content -->
<div class="halloween-sale-container">
  <div class="halloween-sale-content lv-container">
    
    {% assign category_index = 0 %}
    {% for block in section.blocks %}
      {% if block.type == 'product_category' %}
        {% assign category_index = category_index | plus: 1 %}
        <div class="halloween-category" {{ block.shopify_attributes }}>
          <!-- Category Title -->
          {% if block.settings.category_title != blank %}
            <h2 class="halloween-category__title">{{ block.settings.category_title }}</h2>
          {% endif %}
          
          <!-- Category Subtitle -->
          {% if block.settings.category_subtitle != blank %}
            <p class="halloween-category__subtitle">{{ block.settings.category_subtitle }}</p>
          {% endif %}
          
          <!-- Product Swiper -->
          <div class="halloween-swiper-container" data-category-index="{{ category_index }}">
            <div class="halloween-swiper">
              <div class="halloween-swiper-wrapper">
                {% comment %} 遍历该分类下的所有产品块 {% endcomment %}
                {% for product_block in section.blocks %}
                  {% if product_block.type == 'product_item' %}
                    {% assign parent_category_number = product_block.settings.parent_category_number | plus: 0 %}
                    {% if parent_category_number == category_index %}
                      {% assign product = product_block.settings.product %}
                    
                    {% if product %}
                      <div class="halloween-swiper-slide" {{ product_block.shopify_attributes }}>
                        <a href="{{ product.url }}" class="halloween-product-card">
                          <!-- Product Image -->
                          {% if product.featured_image %}
                            <img 
                              src="{{ product.featured_image | image_url: width: 300 }}"
                              srcset="{{ product.featured_image | image_url: width: 185 }} 185w,
                                      {{ product.featured_image | image_url: width: 215 }} 215w,
                                      {{ product.featured_image | image_url: width: 266 }} 266w,
                                      {{ product.featured_image | image_url: width: 300 }} 300w"
                              sizes="(max-width: 374px) 185px, (max-width: 479px) 215px, (max-width: 639px) 266px, (max-width: 767px) 300px, (max-width: 1023px) 224px, (max-width: 1279px) 250px, (max-width: 1535px) 287px, 300px"
                              alt="{{ product.title | escape }}"
                              width="300"
                              height="300"
                              loading="lazy"
                              class="halloween-product-image">
                          {% else %}
                            <div class="halloween-product-image halloween-product-image--placeholder">
                              {{ 'product-1' | placeholder_svg_tag }}
                            </div>
                          {% endif %}
                          
                          <!-- Product Title -->
                          <h3 class="halloween-product-title">{{ product.title }}</h3>
                          
                          <!-- Reviews (Optional) -->
                          {% if section.settings.show_reviews and product.metafields.reviews.rating_count.value %}
                            <div class="halloween-product-reviews">
                              <span class="halloween-product-rating">
                                {{ product.metafields.reviews.rating.value | round: 1 }} ★
                              </span>
                              <span class="halloween-product-review-count">
                                ({{ product.metafields.reviews.rating_count.value }})
                              </span>
                            </div>
                          {% endif %}
                          
                          <!-- Product Price -->
                          <div class="halloween-product-price">
                            {% if product.compare_at_price > product.price %}
                              <span class="halloween-price-compare">${{ product.compare_at_price | money_without_currency | round: 2 }}</span>
                            {% endif %}
                            <span class="halloween-price-sale">${{ product.price | money_without_currency | round: 2 }}</span>
                          </div>
                          
                          <!-- Top Left Tag -->
                          {% if block.settings.tag_image != blank %}
                            <!-- Custom Tag Image (上移一半) -->
                            <img 
                              src="{{ block.settings.tag_image | image_url: width: 140 }}"
                              alt="Sale Tag"
                              width="140"
                              height="140"
                              class="halloween-tag-image"
                              loading="lazy">
                          {% else %}
                            <!-- Discount & Tag Badges -->
                            <div class="halloween-badges">
                              <!-- Discount Badge -->
                              {% if product.compare_at_price > product.price %}
                                {% assign discount_amount = product.compare_at_price | minus: product.price %}
                                {% assign discount_percent = discount_amount | times: 100.0 | divided_by: product.compare_at_price | round %}
                                <div class="halloween-badge halloween-badge--discount">
                                  <span>{{ discount_percent }}%</span>
                                  <span class="halloween-badge-off">OFF</span>
                                </div>
                              {% endif %}
                              
                              <!-- Product Tag (HOT/NEW) -->
                              {% if product.tags contains 'HOT' or product.tags contains 'hot' %}
                                <div class="halloween-badge halloween-badge--hot">HOT</div>
                              {% elsif product.tags contains 'NEW' or product.tags contains 'new' %}
                                <div class="halloween-badge halloween-badge--new">NEW</div>
                              {% endif %}
                            </div>
                          {% endif %}
                          
                          <!-- Shop Now Button -->
                          <div class="halloween-shop-button">
                            {{ product_block.settings.button_text | default: 'Shop Now' }}
                          </div>
                        </a>
                      </div>
                      {% endif %}
                    {% endif %}
                  {% endif %}
                {% endfor %}
              </div>
            </div>

            
            <!-- Navigation Buttons -->
            <div class="halloween-swiper-button-prev halloween-swiper-button-prev-{{ category_index }}">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
            <div class="halloween-swiper-button-next halloween-swiper-button-next-{{ category_index }}">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
          </div>
        </div>
      {% endif %}
    {% endfor %}
    
    <!-- Firework Video Feed (Optional) -->
    {% if section.settings.show_firework_feed and section.settings.firework_playlist != blank %}
      <div class="halloween-firework-section">
        {% render 'firework-feed',
          playlist: section.settings.firework_playlist,
          channel: 'lavivid_hair',
          mode: 'row',
          player_placement: 'bottom-left'
        %}
      </div>
    {% endif %}
    
  </div>
</div>

{% schema %}
{
  "name": "Halloween Sale",
  "tag": "section",
  "class": "halloween-sale-section",
  "settings": [
    {
      "type": "header",
      "content": "Banner Settings"
    },
    {
      "type": "image_picker",
      "id": "banner_desktop",
      "label": "Desktop Banner"
    },
    {
      "type": "image_picker",
      "id": "banner_mobile",
      "label": "Mobile Banner"
    },
    {
      "type": "text",
      "id": "banner_alt",
      "label": "Banner Alt Text",
      "default": "Halloween Hair System Sale"
    },
    {
      "type": "header",
      "content": "Background Settings"
    },
    {
      "type": "color_background",
      "id": "background_gradient",
      "label": "Background Gradient",
      "default": "linear-gradient(180deg, #E4D2C9 0%, #F4F6F8 100%)"
    },
    {
      "type": "header",
      "content": "Firework Video Feed (Optional)"
    },
    {
      "type": "checkbox",
      "id": "show_firework_feed",
      "label": "Show Firework Video Feed",
      "default": false
    },
    {
      "type": "text",
      "id": "firework_playlist",
      "label": "Firework Playlist ID",
      "info": "Enter Firework playlist ID (e.g., 5bJBa2)"
    },
    {
      "type": "checkbox",
      "id": "show_reviews",
      "label": "Show Product Reviews",
      "default": false,
      "info": "Display product ratings and review count"
    }
  ],
  "blocks": [
    {
      "type": "product_category",
      "name": "Product Category",
      "settings": [
        {
          "type": "text",
          "id": "category_title",
          "label": "Category Title",
          "default": "Product Category Title"
        },
        {
          "type": "text",
          "id": "category_subtitle",
          "label": "Category Subtitle",
          "default": "Subtitle Description"
        },
        {
          "type": "image_picker",
          "id": "tag_image",
          "label": "Sale Tag Image (Optional)"
        }
      ]
    },
    {
      "type": "product_item",
      "name": "Product",
      "settings": [
        {
          "type": "number",
          "id": "parent_category_number",
          "label": "Belongs to Category Number",
          "default": 1,
          "info": "Enter 1 for first category, 2 for second category, etc."
        },
        {
          "type": "product",
          "id": "product",
          "label": "Select Product"
        },
        {
          "type": "text",
          "id": "button_text",
          "label": "Button Text",
          "default": "Shop Now",
          "info": "Text displayed on the product button"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Halloween Sale"
    }
  ]
}
{% endschema %}

