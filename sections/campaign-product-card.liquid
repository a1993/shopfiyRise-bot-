{% comment %}
  Flexible Product Card Section
  灵活的商品卡片组件 - 支持通过ID或handle查询单个商品
  
  功能特性:
  - 支持通过商品选择器或handle查询商品
  - 可自定义徽章图片（左上角/右上角）
  - 可自定义链接行为
  - 支持折扣价格显示
  - 响应式设计
{% endcomment %}

{%- liquid
  # 获取商品
  assign product = null
  if section.settings.product != blank
    assign product = section.settings.product
  elsif section.settings.product_handle != blank
    assign product = all_products[section.settings.product_handle]
  endif
  
  # 计算折扣价格
  assign has_discount = false
  assign original_price = 0
  assign discount_price = 0
  
  if product and section.settings.discount_percent > 0
    assign has_discount = true
    assign original_price = product.price
    assign discount_decimal = section.settings.discount_percent | divided_by: 100.0
    assign discount_amount = original_price | times: discount_decimal
    assign discount_price = original_price | minus: discount_amount
  endif
  
  # 确定链接URL
  assign card_url = ''
  if section.settings.custom_url != blank
    assign card_url = section.settings.custom_url
  elsif product
    assign card_url = product.url
  endif
  
  # 确定是否可点击
  assign is_clickable = false
  if card_url != blank and section.settings.enable_link
    assign is_clickable = true
  endif
-%}

<div class="campaign-product-card-section" style="padding: {{ section.settings.padding_top }}px 0 {{ section.settings.padding_bottom }}px;">
  <div class="campaign-product-card-container" style="max-width: {{ section.settings.card_max_width }}px; margin: 0 auto;">
    
    {%- if section.settings.section_title != blank -%}
      <h2 class="campaign-product-card-section__title" style="text-align: {{ section.settings.title_alignment }};">
        {{ section.settings.section_title }}
      </h2>
    {%- endif -%}
    
    {%- if product -%}
      <div class="campaign-product-card {% if section.settings.card_style %}campaign-product-card--{{ section.settings.card_style }}{% endif %}">
        
        {%- comment -%} 商品图片区域 {%- endcomment -%}
        <div class="campaign-product-card__image-wrapper">
          {% if is_clickable %}<a href="{{ card_url }}" class="campaign-product-card__image-link">{% endif %}
            
            {%- if product.featured_image -%}
              <img 
                src="{{ product.featured_image | image_url: width: 800 }}"
                srcset="
                  {{ product.featured_image | image_url: width: 400 }} 400w,
                  {{ product.featured_image | image_url: width: 600 }} 600w,
                  {{ product.featured_image | image_url: width: 800 }} 800w
                "
                sizes="(max-width: 768px) 100vw, 800px"
                alt="{{ product.featured_image.alt | escape | default: product.title }}"
                loading="lazy"
                class="campaign-product-card__image"
              >
            {%- else -%}
              <div class="campaign-product-card__image campaign-product-card__image--placeholder">
                {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
              </div>
            {%- endif -%}
            
            {%- comment -%} 自定义徽章/图片 {%- endcomment -%}
            {%- if section.settings.badge_image != blank -%}
              <div class="campaign-product-card__badge campaign-product-card__badge--{{ section.settings.badge_position }}">
                <img 
                  src="{{ section.settings.badge_image | image_url: width: 200 }}"
                  alt="{{ section.settings.badge_alt_text | escape }}"
                  loading="lazy"
                  class="campaign-product-card__badge-image"
                  style="width: {{ section.settings.badge_size }}px;"
                >
              </div>
            {%- endif -%}
            
            {%- comment -%} 折扣标签 {%- endcomment -%}
            {%- if has_discount and section.settings.show_discount_badge -%}
              <div class="campaign-product-card__discount-badge">
                -{{ section.settings.discount_percent }}%
              </div>
            {%- endif -%}
            
          {% if is_clickable %}</a>{% endif %}
        </div>
        
        {%- comment -%} 商品信息区域 {%- endcomment -%}
        <div class="campaign-product-card__content">
          
          {%- if section.settings.show_vendor and product.vendor != blank -%}
            <div class="campaign-product-card__vendor">{{ product.vendor }}</div>
          {%- endif -%}
          
          <h3 class="campaign-product-card__title">
            {% if is_clickable %}
              <a href="{{ card_url }}" class="campaign-product-card__title-link">
                {{ product.title }}
              </a>
            {% else %}
              {{ product.title }}
            {% endif %}
          </h3>
          
          {%- if section.settings.show_description and product.description != blank -%}
            <div class="campaign-product-card__description">
              {{ product.description | strip_html | truncatewords: section.settings.description_length }}
            </div>
          {%- endif -%}
          
          {%- comment -%} 价格区域 {%- endcomment -%}
          {%- if section.settings.show_price -%}
            <div class="campaign-product-card__price-wrapper">
              {%- if has_discount -%}
                <span class="campaign-product-card__price campaign-product-card__price--sale">
                  {{ discount_price | money }}
                </span>
                <span class="campaign-product-card__price campaign-product-card__price--original">
                  {{ original_price | money }}
                </span>
              {%- else -%}
                <span class="campaign-product-card__price">
                  {{ product.price | money }}
                </span>
              {%- endif -%}
            </div>
          {%- endif -%}
          
          {%- comment -%} 自定义按钮 {%- endcomment -%}
          {%- if section.settings.show_button -%}
            <div class="campaign-product-card__button-wrapper">
              <a 
                href="{{ card_url }}" 
                class="campaign-product-card__button campaign-product-card__button--{{ section.settings.button_style }}"
              >
                {{ section.settings.button_text | default: 'View Product' }}
              </a>
            </div>
          {%- endif -%}
          
          {%- comment -%} 自定义HTML内容 {%- endcomment -%}
          {%- if section.settings.custom_html != blank -%}
            <div class="campaign-product-card__custom-content">
              {{ section.settings.custom_html }}
            </div>
          {%- endif -%}
          
        </div>
      </div>
      
    {%- else -%}
      {%- comment -%} 未找到商品时的占位内容 {%- endcomment -%}
      <div class="campaign-product-card campaign-product-card--placeholder">
        <div class="campaign-product-card__image-wrapper">
          <div class="campaign-product-card__image campaign-product-card__image--placeholder">
            {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
          </div>
        </div>
        <div class="campaign-product-card__content">
          <h3 class="campaign-product-card__title">Product Card</h3>
          <p class="campaign-product-card__description">
            Please select a product or enter a product handle in the section settings.
          </p>
        </div>
      </div>
    {%- endif -%}
    
  </div>
</div>

<style>
  .campaign-product-card-section {
    width: 100%;
  }
  
  .campaign-product-card-container {
    padding: 0 20px;
  }
  
  .campaign-product-card-section__title {
    font-size: 2rem;
    margin-bottom: 2rem;
    font-weight: 600;
  }
  
  .campaign-product-card {
    display: flex;
    flex-direction: column;
    border-radius: {{ section.settings.card_border_radius }}px;
    overflow: hidden;
    background: {{ section.settings.card_background }};
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  
  .campaign-product-card--elevated {
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }
  
  .campaign-product-card--bordered {
    border: 1px solid #e5e5e5;
  }
  
  .campaign-product-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
  }
  
  .campaign-product-card__image-wrapper {
    position: relative;
    width: 100%;
    padding-top: {{ section.settings.image_ratio }}%;
    overflow: hidden;
    background: #f5f5f5;
  }
  
  .campaign-product-card__image-link {
    display: block;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }
  
  .campaign-product-card__image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }
  
  .campaign-product-card:hover .campaign-product-card__image {
    transform: scale(1.05);
  }
  
  .campaign-product-card__image--placeholder {
    display: flex;
    align-items: center;
    justify-content: center;
    background: #f0f0f0;
  }
  
  .campaign-product-card__image--placeholder svg {
    width: 50%;
    height: 50%;
    opacity: 0.3;
  }
  
  /* 徽章样式 */
  .campaign-product-card__badge {
    position: absolute;
    z-index: 2;
  }
  
  .campaign-product-card__badge--top-left {
    top: 12px;
    left: 12px;
  }
  
  .campaign-product-card__badge--top-right {
    top: 12px;
    right: 12px;
  }
  
  .campaign-product-card__badge--bottom-left {
    bottom: 12px;
    left: 12px;
  }
  
  .campaign-product-card__badge--bottom-right {
    bottom: 12px;
    right: 12px;
  }
  
  .campaign-product-card__badge-image {
    display: block;
    max-width: 100%;
    height: auto;
  }
  
  /* 折扣标签 */
  .campaign-product-card__discount-badge {
    position: absolute;
    top: 12px;
    right: 12px;
    background: #e74c3c;
    color: white;
    padding: 6px 12px;
    border-radius: 4px;
    font-weight: 600;
    font-size: 0.875rem;
    z-index: 1;
  }
  
  /* 内容区域 */
  .campaign-product-card__content {
    padding: {{ section.settings.content_padding }}px;
  }
  
  .campaign-product-card__vendor {
    font-size: 0.875rem;
    color: #666;
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  .campaign-product-card__title {
    font-size: 1.5rem;
    margin: 0 0 12px;
    font-weight: 600;
    line-height: 1.3;
  }
  
  .campaign-product-card__title-link {
    color: inherit;
    text-decoration: none;
    transition: color 0.2s ease;
  }
  
  .campaign-product-card__title-link:hover {
    color: {{ section.settings.accent_color }};
  }
  
  .campaign-product-card__description {
    font-size: 1rem;
    color: #666;
    line-height: 1.6;
    margin-bottom: 16px;
  }
  
  /* 价格样式 */
  .campaign-product-card__price-wrapper {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 20px;
  }
  
  .campaign-product-card__price {
    font-size: 1.5rem;
    font-weight: 700;
    color: #333;
  }
  
  .campaign-product-card__price--sale {
    color: #e74c3c;
  }
  
  .campaign-product-card__price--original {
    text-decoration: line-through;
    color: #999;
    font-size: 1.2rem;
    font-weight: 400;
  }
  
  /* 按钮样式 */
  .campaign-product-card__button-wrapper {
    margin-top: 20px;
  }
  
  .campaign-product-card__button {
    display: inline-block;
    padding: 14px 28px;
    text-align: center;
    text-decoration: none;
    border-radius: 4px;
    font-weight: 600;
    transition: all 0.3s ease;
    cursor: pointer;
    border: 2px solid transparent;
  }
  
  .campaign-product-card__button--primary {
    background: {{ section.settings.button_color }};
    color: {{ section.settings.button_text_color }};
  }
  
  .campaign-product-card__button--primary:hover {
    background: {{ section.settings.button_color | color_darken: 10 }};
  }
  
  .campaign-product-card__button--outline {
    background: transparent;
    color: {{ section.settings.button_color }};
    border-color: {{ section.settings.button_color }};
  }
  
  .campaign-product-card__button--outline:hover {
    background: {{ section.settings.button_color }};
    color: {{ section.settings.button_text_color }};
  }
  
  .campaign-product-card__button--text {
    background: transparent;
    color: {{ section.settings.button_color }};
    padding: 8px 0;
  }
  
  .campaign-product-card__button--text:hover {
    color: {{ section.settings.button_color | color_darken: 15 }};
  }
  
  /* 自定义内容 */
  .campaign-product-card__custom-content {
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid #e5e5e5;
  }
  
  /* 响应式设计 */
  @media (max-width: 768px) {
    .campaign-product-card-section__title {
      font-size: 1.5rem;
      margin-bottom: 1.5rem;
    }
    
    .campaign-product-card__title {
      font-size: 1.25rem;
    }
    
    .campaign-product-card__price {
      font-size: 1.25rem;
    }
    
    .campaign-product-card__button {
      width: 100%;
      display: block;
    }
    
    .campaign-product-card__badge--top-left,
    .campaign-product-card__badge--top-right,
    .campaign-product-card__badge--bottom-left,
    .campaign-product-card__badge--bottom-right {
      top: 8px;
      right: 8px;
      left: auto;
      bottom: auto;
    }
  }
</style>

{% schema %}
{
  "name": "Product Card",
  "tag": "section",
  "class": "section-product-card",
  "settings": [
    {
      "type": "header",
      "content": "Section Settings"
    },
    {
      "type": "text",
      "id": "section_title",
      "label": "Section Title",
      "info": "Optional section title above the card"
    },
    {
      "type": "select",
      "id": "title_alignment",
      "label": "Title Alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "center"
    },
    {
      "type": "range",
      "id": "card_max_width",
      "min": 300,
      "max": 1200,
      "step": 50,
      "unit": "px",
      "label": "Card Max Width",
      "default": 600
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding Top",
      "default": 40
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding Bottom",
      "default": 40
    },
    {
      "type": "header",
      "content": "Product Selection"
    },
    {
      "type": "product",
      "id": "product",
      "label": "Product",
      "info": "Select a product using the product picker"
    },
    {
      "type": "text",
      "id": "product_handle",
      "label": "Product Handle (Alternative)",
      "info": "Or enter a product handle manually. This will be used if no product is selected above."
    },
    {
      "type": "header",
      "content": "Card Style"
    },
    {
      "type": "select",
      "id": "card_style",
      "label": "Card Style",
      "options": [
        {
          "value": "flat",
          "label": "Flat"
        },
        {
          "value": "elevated",
          "label": "Elevated (Shadow)"
        },
        {
          "value": "bordered",
          "label": "Bordered"
        }
      ],
      "default": "elevated"
    },
    {
      "type": "color",
      "id": "card_background",
      "label": "Card Background",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "card_border_radius",
      "min": 0,
      "max": 30,
      "step": 2,
      "unit": "px",
      "label": "Border Radius",
      "default": 8
    },
    {
      "type": "range",
      "id": "content_padding",
      "min": 0,
      "max": 60,
      "step": 4,
      "unit": "px",
      "label": "Content Padding",
      "default": 24
    },
    {
      "type": "header",
      "content": "Image Settings"
    },
    {
      "type": "range",
      "id": "image_ratio",
      "min": 50,
      "max": 150,
      "step": 5,
      "unit": "%",
      "label": "Image Aspect Ratio",
      "info": "100% = Square, 75% = Landscape, 125% = Portrait",
      "default": 100
    },
    {
      "type": "header",
      "content": "Badge / Overlay Image"
    },
    {
      "type": "image_picker",
      "id": "badge_image",
      "label": "Badge Image",
      "info": "Upload an image to display on the product image (e.g., logo, badge, icon)"
    },
    {
      "type": "text",
      "id": "badge_alt_text",
      "label": "Badge Alt Text",
      "default": "Badge"
    },
    {
      "type": "select",
      "id": "badge_position",
      "label": "Badge Position",
      "options": [
        {
          "value": "top-left",
          "label": "Top Left"
        },
        {
          "value": "top-right",
          "label": "Top Right"
        },
        {
          "value": "bottom-left",
          "label": "Bottom Left"
        },
        {
          "value": "bottom-right",
          "label": "Bottom Right"
        }
      ],
      "default": "top-left"
    },
    {
      "type": "range",
      "id": "badge_size",
      "min": 30,
      "max": 200,
      "step": 10,
      "unit": "px",
      "label": "Badge Size",
      "default": 80
    },
    {
      "type": "header",
      "content": "Discount Settings"
    },
    {
      "type": "range",
      "id": "discount_percent",
      "min": 0,
      "max": 99,
      "step": 1,
      "unit": "%",
      "label": "Discount Percentage",
      "info": "Set to 0 to disable discount",
      "default": 0
    },
    {
      "type": "checkbox",
      "id": "show_discount_badge",
      "label": "Show Discount Badge",
      "default": true
    },
    {
      "type": "header",
      "content": "Display Options"
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": "Show Vendor/Brand",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_description",
      "label": "Show Description",
      "default": true
    },
    {
      "type": "range",
      "id": "description_length",
      "min": 10,
      "max": 100,
      "step": 5,
      "label": "Description Word Count",
      "default": 30
    },
    {
      "type": "checkbox",
      "id": "show_price",
      "label": "Show Price",
      "default": true
    },
    {
      "type": "header",
      "content": "Link Settings"
    },
    {
      "type": "checkbox",
      "id": "enable_link",
      "label": "Enable Link",
      "default": true
    },
    {
      "type": "url",
      "id": "custom_url",
      "label": "Custom URL",
      "info": "Leave blank to use the product URL. Or enter a custom URL (e.g., /pages/campaign)"
    },
    {
      "type": "header",
      "content": "Button Settings"
    },
    {
      "type": "checkbox",
      "id": "show_button",
      "label": "Show Button",
      "default": true
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button Text",
      "default": "View Product"
    },
    {
      "type": "select",
      "id": "button_style",
      "label": "Button Style",
      "options": [
        {
          "value": "primary",
          "label": "Primary (Filled)"
        },
        {
          "value": "outline",
          "label": "Outline"
        },
        {
          "value": "text",
          "label": "Text Only"
        }
      ],
      "default": "primary"
    },
    {
      "type": "color",
      "id": "button_color",
      "label": "Button Color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button Text Color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "accent_color",
      "label": "Accent Color",
      "info": "Used for hover effects",
      "default": "#e74c3c"
    },
    {
      "type": "header",
      "content": "Custom Content"
    },
    {
      "type": "html",
      "id": "custom_html",
      "label": "Custom HTML",
      "info": "Add custom HTML content below the button"
    }
  ],
  "presets": [
    {
      "name": "Product Card",
      "category": "Product"
    }
  ]
}
{% endschema %}

